
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="..">
      
      
        <link rel="next" href="../user-how-to/creating-dags/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.7">
    
    
      
        <title>Getting Started - Limesurvey ETL</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.4b4a2bd9.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.356b1318.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="darkblue" data-md-color-accent="purple">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#getting-started" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Limesurvey ETL" class="md-header__button md-logo" aria-label="Limesurvey ETL" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Limesurvey ETL
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Getting Started
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="darkblue" data-md-color-accent="purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="lime"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
      </label>
    
  
</form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
    
  
  
    <li class="md-tabs__item md-tabs__item--active">
      <a href="./" class="md-tabs__link">
        
  
    
  
  Getting Started

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../user-how-to/creating-dags/" class="md-tabs__link">
          
  
  User Guide

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Limesurvey ETL" class="md-nav__button md-logo" aria-label="Limesurvey ETL" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Limesurvey ETL
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-etl-pipelines" class="md-nav__link">
    Running ETL pipelines
  </a>
  
    <nav class="md-nav" aria-label="Running ETL pipelines">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-running-an-etl-pipeline-locally" class="md-nav__link">
    1. Running an ETL pipeline locally
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-orchestrating-etl-pipelines-with-airflow" class="md-nav__link">
    2. Orchestrating ETL pipelines with Airflow
  </a>
  
    <nav class="md-nav" aria-label="2. Orchestrating ETL pipelines with Airflow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#setting-necessary-environment-variables" class="md-nav__link">
    Setting necessary environment variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setup-airflow" class="md-nav__link">
    Setup Airflow
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-etl-pipelines" class="md-nav__link">
    Adding ETL pipelines
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clean-up" class="md-nav__link">
    Clean up
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    User Guide
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            User Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../user-how-to/creating-dags/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Creation and configuration of new ETL pipelines in Airflow
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../user-how-to/etl-config-how-to/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ETL Configs How To
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="getting-started">Getting Started</h1>
<p>The following documentation describes the installation process that will get you up and running to implement your own ETL jobs.</p>
<h2 id="prerequisites">Prerequisites</h2>
<p>Install <a href="https://docs.docker.com/get-docker/">Docker</a> and <a href="https://docs.docker.com/compose/install/">Docker Compose</a>.</p>
<p>If you want to contribute to this project or run an ETL pipeline locally without Airflow, you need to install the required dependencies.</p>
<ul>
<li><a href="https://www.python.org/"><code>Python</code></a>&gt;=3.10.0</li>
<li><a href="https://python-poetry.org/"><code>poetry</code></a>&gt;=1.6.1</li>
</ul>
<p>Once you installed the dependencies, <code>cd</code> into the project's root directory in your terminal and run <code>poetry install --with dev</code> to install the required python dependencies into a virtual environment. To activate the virtual environment, run <code>poetry shell</code>.</p>
<h2 id="running-etl-pipelines">Running ETL pipelines</h2>
<p>You can run your ETL pipelines either locally with Python or using Airflow.</p>
<h3 id="1-running-an-etl-pipeline-locally">1. Running an ETL pipeline locally</h3>
<p>To run an ETL pipeline locally, you must set a number of environment variables.</p>
<p>Create a <code>.env</code> file and store it at the project repository's root directory. Open the <code>.env</code> file you just created in your IDE or text editor and append the following three blocks of environment variables to it:</p>
<ul>
<li><strong>Limesurvey DB related variables</strong>: These variables are required for the platform to connect with the Limesurvey database. You must provide the variables for establishing an SSH connection as well as for the actual Limesurvey database.</li>
<li><strong>Staging database related variables</strong>: The staging database is where the raw and intermediary data are stored. You can provide values for a MySQL DB / MariaDB (set <code>STAGING_DB_SQLALCHEMY_DRIVER="mysql+pymysql"</code>) or a PostgresDB (set <code>STAGING_DB_SQLALCHEMY_DRIVER="postgresql"</code>). Other databases are currently not supported.</li>
<li><strong>Reporting database related variables</strong>:  The reporting database is where the final (i.e., reporting) data is stored. You can provide values for a MySQL DB / MariaDB (set <code>STAGING_DB_SQLALCHEMY_DRIVER="mysql+pymysql"</code>) or a PostgresDB (set <code>STAGING_DB_SQLALCHEMY_DRIVER="postgresql"</code>). Other databases are currently not supported. <strong>It is possible to use the same database as staging and reporting database</strong>.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="c1"># Variables required to connect with the Limesurvey Database</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="nv">LIMESURVEY_USE_SSH</span><span class="o">=</span>True<span class="w"> </span><span class="c1"># set to False if ssh is not used</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="nv">LIMESURVEY_SSH_PORT</span><span class="o">=</span><span class="s2">&quot;&lt;LIMESURVEY_SSH_PORT_IF_SSH_IS_USED_ELSE_DELETE_VARIABLE&gt;&quot;</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="nv">LIMESURVEY_SSH_HOST</span><span class="o">=</span><span class="s2">&quot;&lt;LIMESURVEY_SSH_HOST_IF_SSH_IS_USED_ELSE_DELETE_VARIABLE&gt;&quot;</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="nv">LIMESURVEY_SSH_USERNAME</span><span class="o">=</span><span class="s2">&quot;&lt;LIMESURVEY_SSH_USER_IF_SSH_IS_USED_ELSE_DELETE_VARIABLE&gt;&quot;</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="nv">LIMESURVEY_SSH_PASSWORD</span><span class="o">=</span><span class="s2">&quot;&lt;LIMESURVEY_SSH_PW_IF_SSH_IS_USED_ELSE_DELETE_VARIABLE&gt;&quot;</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="nv">LIMESURVEY_DB_NAME</span><span class="o">=</span><span class="s2">&quot;&lt;NAME OF THE LIMESURVEY DB&gt;&quot;</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="nv">LIMESURVEY_DB_PORT</span><span class="o">=</span><span class="s2">&quot;&lt;PORT OF THE LIMESURVEY DB&gt;&quot;</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="nv">LIMESURVEY_DB_USERNAME</span><span class="o">=</span><span class="s2">&quot;&lt;LIMESURVEY DB SQL USER&gt;&quot;</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="nv">LIMESURVEY_DB_PASSWORD</span><span class="o">=</span><span class="s2">&quot;LIMESURVEY DB SQL PASSWORD&quot;</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="nv">LIMESURVEY_DB_HOST</span><span class="o">=</span><span class="s2">&quot;127.0.0.1&quot;</span><span class="w"> </span><span class="c1"># always 127.0.0.1 if SSH is used, or actual host if SSH is not used</span>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="c1"># Variables for connecting with the database where you want raw and intermediary data to be stored</span>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="nv">STAGING_DB_SQLALCHEMY_DRIVER</span><span class="o">=</span><span class="s2">&quot;postgresql&quot;</span><span class="w"> </span><span class="c1"># &quot;postgresql&quot; for a postgres DB or &quot;mysql+pymysql&quot; if Staging DB is a MYSQL DB (e.g., MariaDB)</span>
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="nv">STAGING_DB_USERNAME</span><span class="o">=</span><span class="s2">&quot;&lt;SQL USER OF THE STAGING DB&quot;</span>
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a><span class="nv">STAGING_DB_PASSWORD</span><span class="o">=</span><span class="s2">&quot;&lt;PASSWORD OF THE STAGING DB SQL USER&gt;&quot;</span>
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a><span class="nv">STAGING_DB_NAME</span><span class="o">=</span><span class="s2">&quot;&lt;NAME OF THE STAGING DB&gt;&quot;</span>
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a><span class="nv">STAGING_DB_HOST</span><span class="o">=</span><span class="s2">&quot;&lt;HOST OF THE STAGING DB&gt;&quot;</span>
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a><span class="nv">STAGING_DB_PORT</span><span class="o">=</span><span class="s2">&quot;&lt;PORT OF THE STAGING DB&gt;&quot;</span>
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a>
<a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a><span class="c1"># Variables for connecting with the database where you want the final (i.e., reporting) data to be stored</span>
<a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a><span class="c1"># Can be the same database as the staging database</span>
<a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a><span class="nv">REPORTING_DB_SQLALCHEMY_DRIVER</span><span class="o">=</span><span class="s2">&quot;postgresql&quot;</span><span class="w"> </span><span class="c1"># &quot;postgresql&quot; for a postgres DB or &quot;mysql+pymysql&quot; if reporting DB is a MYSQL DB (e.g., MariaDB)</span>
<a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a><span class="nv">REPORTING_DB_PASSWORD</span><span class="o">=</span><span class="s2">&quot;&lt;PW OF THE REPORTING DB SQL USER&gt;&quot;</span>
<a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a><span class="nv">REPORTING_DB_NAME</span><span class="o">=</span><span class="s2">&quot;&lt;NAME OF THE REPORTING DB&gt;&quot;</span>
<a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a><span class="nv">REPORTING_DB_HOST</span><span class="o">=</span><span class="s2">&quot;&lt;HOST OF THE REPORTING DB&gt;&quot;</span>
<a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a><span class="nv">REPORTING_DB_PORT</span><span class="o">=</span><span class="s2">&quot;&lt;PORT OF THE REPORTING DB&gt;&quot;</span>
<a id="__codelineno-0-28" name="__codelineno-0-28" href="#__codelineno-0-28"></a><span class="nv">REPORTING_DB_USERNAME</span><span class="o">=</span><span class="s2">&quot;&lt;SQL USER OF THE REPORTING DB&gt;&quot;</span>
</code></pre></div>
<p>Next, you can start adding an ETL pipeline configuration as described in the <a href="../user-how-to/creating-dags/">User Guide</a> section.</p>
<p>Once you created a pipeline configuration, you can run it from your terminal by entering the following command:</p>
<p><code>poetry run python -m limesurvey_etl --config_file &lt;PATH/TO/YOUR/config.yaml --steps all</code></p>
<ul>
<li>The <code>--config_file</code> flag specifies the path to the configuration <code>.yaml</code>-file to be used for the pipeline</li>
<li>The <code>--steps</code> flag specifies which step(s) of the ETL pipeline should be executed. Choices:<ul>
<li><code>extract</code>: Only the extract step is executed.</li>
<li><code>transform</code>: Only the transform step is executed.</li>
<li><code>load</code>: Only the load step is executed.</li>
<li><code>all</code>: All steps (i.e., extract, transform, and load) are executed.</li>
</ul>
</li>
</ul>
<h3 id="2-orchestrating-etl-pipelines-with-airflow">2. Orchestrating ETL pipelines with Airflow</h3>
<p>This project supports <a href="https://airflow.apache.org/">Airflow</a> to orchestrate ETL pipelines.</p>
<h4 id="setting-necessary-environment-variables">Setting necessary environment variables</h4>
<p>In order to run Airflow and allow the ETL pipelines to communicate with the source and target databases, you must set a number of environment variables.</p>
<p>Create a <code>.env</code> file and set the Airflow UID by running the following command from the project's root directory:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;AIRFLOW_UID=</span><span class="k">$(</span>id<span class="w"> </span>-u<span class="k">)</span><span class="s2">&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>.env
</code></pre></div>
<p>Open the <code>.env</code> file you just created in your IDE or text editor and append the following four blocks of environment variables to it:</p>
<ul>
<li><strong>Airflow related variables</strong>: You can choose arbitrary values here. These are required for logging into the Airflow UI and the Airflow DB (advanced users), which contains Airflow related metadata.</li>
<li><strong>Limesurvey DB related variables</strong>: These variables are required for the platform to connect with the Limesurvey database. You must provide the variables for establishing an SSH connection as well as for the actual Limesurvey database.</li>
<li><strong>Staging database related variables</strong>: The staging database is where the raw and intermediary data are stored. You can provide values for a MySQL DB / MariaDB (set <code>STAGING_DB_SQLALCHEMY_DRIVER="mysql+pymysql"</code>) or a PostgresDB (set <code>STAGING_DB_SQLALCHEMY_DRIVER="postgresql"</code>). Other databases are currently not supported. <strong>Note:</strong> If the database is running on the same machine as airflow, then set <code>STAGING_DB_HOST=host.docker.internal</code>!</li>
<li><strong>Reporting database related variables</strong>:  The reporting database is where the final (i.e., reporting) data is stored. You can provide values for a MySQL DB / MariaDB (set <code>STAGING_DB_SQLALCHEMY_DRIVER="mysql+pymysql"</code>) or a PostgresDB (set <code>STAGING_DB_SQLALCHEMY_DRIVER="postgresql"</code>). Other databases are currently not supported. <strong>Note:</strong> If the database is running on the same machine as airflow, then set <code>REPORTING_DB_HOST=host.docker.internal</code>! <strong>It is possible to use the same database as staging and reporting database</strong>.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="c1"># Airflow related variables</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="nv">AIRFLOW_PG_USER</span><span class="o">=</span><span class="s2">&quot;&lt;USERNAME_FOR_AIRFLOW_DB&gt;&quot;</span><span class="w"> </span><span class="c1"># choose a username for the airflow db</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="nv">AIRFLOW_PG_PASSWORD</span><span class="o">=</span><span class="s2">&quot;&lt;PASSWORD_FOR_AIRFLOW_DB_USER&gt;&quot;</span><span class="w"> </span><span class="c1"># set a password for the airflow db user</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="nv">AIRFLOW_PG_DB</span><span class="o">=</span><span class="s2">&quot;&lt;AIRFLOW_DB_NAME&gt;&quot;</span><span class="w"> </span><span class="c1"># choose a name for the airflow db</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="nv">_AIRFLOW_WWW_USER_USERNAME</span><span class="o">=</span><span class="s2">&quot;&lt;USERNAME_FOR_AIRFLOW_UI_LOGIN&gt;&quot;</span><span class="w"> </span><span class="c1"># choose an admin username for logging into the Airflow UI (you can add additional users later via the &quot;Security&quot; tab in the Airflow UI)</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="nv">_AIRFLOW_WWW_USER_PASSWORD</span><span class="o">=</span><span class="s2">&quot;&lt;PW_FOR_AIRFLOW_UI_LOGIN&gt;&quot;</span><span class="w"> </span><span class="c1"># choose a password to login to the Airflow UI</span>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="c1"># Variables required to connect with the Limesurvey Database</span>
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="nv">LIMESURVEY_SSH_PORT</span><span class="o">=</span><span class="s2">&quot;&lt;LIMESURVEY_SSH_PORT_IF_SSH_IS_USED_ELSE_DELETE_VARIABLE&gt;&quot;</span>
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="nv">LIMESURVEY_SSH_HOST</span><span class="o">=</span><span class="s2">&quot;&lt;LIMESURVEY_SSH_HOST_IF_SSH_IS_USED_ELSE_DELETE_VARIABLE&gt;&quot;</span>
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="nv">LIMESURVEY_SSH_USERNAME</span><span class="o">=</span><span class="s2">&quot;&lt;LIMESURVEY_SSH_USER_IF_SSH_IS_USED_ELSE_DELETE_VARIABLE&gt;&quot;</span>
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a><span class="nv">LIMESURVEY_SSH_PASSWORD</span><span class="o">=</span><span class="s2">&quot;&lt;LIMESURVEY_SSH_PW_IF_SSH_IS_USED_ELSE_DELETE_VARIABLE&gt;&quot;</span>
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a><span class="nv">LIMESURVEY_DB_NAME</span><span class="o">=</span><span class="s2">&quot;&lt;NAME OF THE LIMESURVEY DB&gt;&quot;</span>
<a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a><span class="nv">LIMESURVEY_DB_PORT</span><span class="o">=</span><span class="s2">&quot;&lt;PORT OF THE LIMESURVEY DB&gt;&quot;</span>
<a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a><span class="nv">LIMESURVEY_DB_USERNAME</span><span class="o">=</span><span class="s2">&quot;&lt;LIMESURVEY DB SQL USER&gt;&quot;</span>
<a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a><span class="nv">LIMESURVEY_DB_PASSWORD</span><span class="o">=</span><span class="s2">&quot;LIMESURVEY DB SQL PASSWORD&quot;</span>
<a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a><span class="nv">LIMESURVEY_DB_HOST</span><span class="o">=</span><span class="s2">&quot;127.0.0.1&quot;</span><span class="w"> </span><span class="c1"># or actual host if SSH is not used</span>
<a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a>
<a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a><span class="c1"># Variables for connecting with the database where you want raw and intermediary data to be stored</span>
<a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a><span class="nv">STAGING_DB_SQLALCHEMY_DRIVER</span><span class="o">=</span><span class="s2">&quot;postgresql&quot;</span><span class="w"> </span><span class="c1"># &quot;postgresql&quot; for a postgres DB or &quot;mysql+pymysql&quot; if Staging DB is a MYSQL DB (e.g., MariaDB)</span>
<a id="__codelineno-2-21" name="__codelineno-2-21" href="#__codelineno-2-21"></a><span class="nv">STAGING_DB_USERNAME</span><span class="o">=</span><span class="s2">&quot;&lt;SQL USER OF THE STAGING DB&quot;</span>
<a id="__codelineno-2-22" name="__codelineno-2-22" href="#__codelineno-2-22"></a><span class="nv">STAGING_DB_PASSWORD</span><span class="o">=</span><span class="s2">&quot;&lt;PASSWORD OF THE STAGING DB SQL USER&gt;&quot;</span>
<a id="__codelineno-2-23" name="__codelineno-2-23" href="#__codelineno-2-23"></a><span class="nv">STAGING_DB_NAME</span><span class="o">=</span><span class="s2">&quot;&lt;NAME OF THE STAGING DB&gt;&quot;</span>
<a id="__codelineno-2-24" name="__codelineno-2-24" href="#__codelineno-2-24"></a><span class="nv">STAGING_DB_HOST</span><span class="o">=</span><span class="s2">&quot;&lt;HOST OF THE STAGING DB&gt;&quot;</span><span class="w"> </span><span class="c1"># host.docker.internal for usage with ariflow if DB is running on same machine as airflow</span>
<a id="__codelineno-2-25" name="__codelineno-2-25" href="#__codelineno-2-25"></a><span class="nv">STAGING_DB_PORT</span><span class="o">=</span><span class="s2">&quot;&lt;PORT OF THE STAGING DB&gt;&quot;</span>
<a id="__codelineno-2-26" name="__codelineno-2-26" href="#__codelineno-2-26"></a>
<a id="__codelineno-2-27" name="__codelineno-2-27" href="#__codelineno-2-27"></a><span class="c1"># Variables for connecting with the database where you want the final (i.e., reporting) data to be stored</span>
<a id="__codelineno-2-28" name="__codelineno-2-28" href="#__codelineno-2-28"></a><span class="c1"># Can be the same database as the staging database</span>
<a id="__codelineno-2-29" name="__codelineno-2-29" href="#__codelineno-2-29"></a><span class="nv">REPORTING_DB_SQLALCHEMY_DRIVER</span><span class="o">=</span><span class="s2">&quot;postgresql&quot;</span><span class="w"> </span><span class="c1"># &quot;postgresql&quot; for a postgres DB or &quot;mysql+pymysql&quot; if reporting DB is a MYSQL DB (e.g., MariaDB)</span>
<a id="__codelineno-2-30" name="__codelineno-2-30" href="#__codelineno-2-30"></a><span class="nv">REPORTING_DB_PASSWORD</span><span class="o">=</span><span class="s2">&quot;&lt;PW OF THE REPORTING DB SQL USER&gt;&quot;</span>
<a id="__codelineno-2-31" name="__codelineno-2-31" href="#__codelineno-2-31"></a><span class="nv">REPORTING_DB_NAME</span><span class="o">=</span><span class="s2">&quot;&lt;NAME OF THE REPORTING DB&gt;&quot;</span>
<a id="__codelineno-2-32" name="__codelineno-2-32" href="#__codelineno-2-32"></a><span class="nv">REPORTING_DB_HOST</span><span class="o">=</span><span class="s2">&quot;&lt;HOST OF THE REPORTING DB&gt;&quot;</span><span class="w"> </span><span class="c1"># host.docker.internal for usage with ariflow if DB is running on same machine as airflow</span>
<a id="__codelineno-2-33" name="__codelineno-2-33" href="#__codelineno-2-33"></a><span class="nv">REPORTING_DB_PORT</span><span class="o">=</span><span class="s2">&quot;&lt;PORT OF THE REPORTING DB&gt;&quot;</span>
<a id="__codelineno-2-34" name="__codelineno-2-34" href="#__codelineno-2-34"></a><span class="nv">REPORTING_DB_USERNAME</span><span class="o">=</span><span class="s2">&quot;&lt;SQL USER OF THE REPORTING DB&gt;&quot;</span>
</code></pre></div>
<h4 id="setup-airflow">Setup Airflow</h4>
<p>To start Airflow, make sure the Docker daemon is running (e.g., by starting docker desktop or starting the docker service) and run
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>docker<span class="w"> </span>compose<span class="w"> </span>up
</code></pre></div>
This may take a while. Once the setup is complete, you should repeatedly see a message similar to the following in your terminal:
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>limesurvey-etl-airflow-webserver-1  | 127.0.0.1 - - [19/Oct/2023:14:16:17 +0000] &quot;GET /health HTTP/1.1&quot; 200 141 &quot;-&quot; &quot;curl/7.74.0&quot;
</code></pre></div></p>
<p>The Airflow Webserver is now running and the Airflow UI can be accessed through a regular browser by entering the following URL: <code>localhost:8080</code>. Use the credentials defined in your <code>.env</code> file (<code>_AIRFLOW_WWW_USER_USERNAME</code> and <code>_AIRFLOW_WWW_USER_PASSWORD</code>) to login. You can add additional users via the "Security" tab at the top of the Airflow UI after successful login. Airflow DAGs will run depending on their schedules as long as Airflow is running. Press <code>control+c</code> or <code>strg+c</code> to stop the process, depending on your operating system.</p>
<h4 id="adding-etl-pipelines">Adding ETL pipelines</h4>
<p>Once Airflow is up and running, you can start adding your ETL pipelines as described in the <a href="../user-how-to/creating-dags/">User Guide</a>.</p>
<h4 id="clean-up">Clean up</h4>
<p>To clean up the environment, run
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>docker compose down --volumes --rmi all
</code></pre></div>
Note: This will not delete any Limesurvey data or data generated during an ETL pipeline run from your target databases, but only remove the Airflow environment.# Partner organization</p>
<p>This project was conducted in collaboration with the <a href="https://citizensforeurope.org/advocating_for_inclusion_page/">Vielfalt entscheidet</a> project of Citizens For Europe gUG.</p>





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "navigation.sections", "toc.integrate", "navigation.top", "search.suggest", "search.highlight", "content.tabs.link", "content.code.annotation", "content.code.copy"], "search": "../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.aecac24b.min.js"></script>
      
    
  </body>
</html>